<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Jobs & the Runtime</title>
    <meta name="description" content="Training guides and documentation for drush.io, the distributed runtime utility shell.
">
    <link type="text/css" rel="stylesheet" href="/assets/css/app.css" media="screen,projection">
    <link type="text/css" rel="stylesheet" href="/assets/css/pygments.css" media="screen,projection">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="canonical" href="http://localhost:4000/jobs-and-the-runtime">
</head>

<body>
    <header>
        <div class="navbar-fixed">
<nav class="white blue-text z-depth-0">
    <ul id="slide-out" class="side-nav">
        <li><a href="/">Home</a></li>
        
            
                <li><a href="/api">API</a></li>
            
        
            
        
            
                <li><a href="/getting-started">Getting Started</a></li>
            
        
            
        
            
                <li><a href="/jobs-and-the-runtime">Jobs & the Runtime</a></li>
            
        
            
                <li><a href="/the-basics">The Basics</a></li>
            
        
    </ul>
    <div class="container container-large">
    <a class="brand-logo" href="/"><span class="grey-text text-darken-4"><img src="/assets/img/logo-64.png" alt="drush.io" class="logo" /> drush.io</span></a>
    <ul class="right hide-on-med-and-down">
        
        
            
        
            
        
            
                <li><a href="/the-basics" class="grey-text text-darken-4">The Basics</a></li>
            
        
            
                <li><a href="/getting-started" class="grey-text text-darken-4">Getting Started</a></li>
            
        
            
                <li><a href="/jobs-and-the-runtime" class="grey-text text-darken-4">Jobs & the Runtime</a></li>
            
        
            
                <li><a href="/api" class="grey-text text-darken-4">API</a></li>
            
        
    </ul>
    <a href="#" data-activates="slide-out" class="button-collapse right grey-text text-darken-4"><i class="material-icons">keyboard_arrow_down</i></a>
    </div>
</nav>
</div>

    </header>
    <main>
        <div class="grey lighten-2">
    <div class="row no-margin">
        <div class="col s12">
            <h2 class="center-align">Jobs & the Runtime</h2>
            <div class="divider"></div>
        </div>
    </div>
</div>
<!--<div class="container">
    <div class="section">-->
        <article class="row no-margin grey-text text-darken-2 post-content">
            <div class="col s12 no-padding">
  <ul class="tabs tabs-fixed-width">
    <li class="tab col s3"><a href="#runtime"><i class="material-icons">storage</i> The runtime</a></li>
    <li class="tab col s3"><a href="#logical-operators"><i class="material-icons">settings</i> Logical operators</a></li>
    <li class="tab col s3"><a href="#substitution"><i class="material-icons">swap_horiz</i> Command substitution</a></li>
    <li class="tab col s3"><a href="#variables"><i class="material-icons">attach_money</i> Variables</a></li>
    <li class="tab col s3"><a href="#io-redirection"><i class="material-icons">call_split</i> I/O redirection</a></li>
  </ul>
</div>
<div class="container">
  <div id="runtime" class="col s12">
<div>

      <h3 id="runtime">Runtime</h3>

      <p>Every job run on drush.io is executed in an isolated container, offering a clean runtime environment for every run. No state persists between runs, ensuring predictable behavior.</p>

      <h4 id="the-environment">The environment</h4>
      <p>Because job runs are queued by individuals, every job run is invoked in the context of the individual account’s <a href="/the-basics#concepts">credential</a>. That means all commands executed during the job run are run with terminus pre-authenticated and with SSH keys appropriate to run remote commands. No need to run <code class="highlighter-rouge">terminus auth:login</code> in your job!</p>

      <p>All commands are run in an initially empty file directory. You can populate the current working directory using a tool like <code class="highlighter-rouge">git</code>.</p>

      <h4 id="available-cli-tools">Available CLI tools</h4>
      <p>The following CLI tools are available and considered supported in the runtime:</p>

      <ul>
        <li><code class="highlighter-rouge">echo</code></li>
        <li><code class="highlighter-rouge">terminus</code></li>
        <li><code class="highlighter-rouge">git</code></li>
        <li><code class="highlighter-rouge">mysql</code></li>
      </ul>

      <p>It’s important to note that, while drush.io jobs resemble a shell script, they aren’t exactly shell scripts. Stick to the supported job syntax and you’ll be golden!</p>

      <p>Speaking of syntax, dive in with <a href="#logical-operators">logical operators</a>.</p>

    </div>
  </div>
  <div id="logical-operators" class="col s12">
<div>

      <h3 id="logical-operators">Logical Operators</h3>

      <p>All commands exit with a status code when they complete: <code class="highlighter-rouge">0</code> means everything went according to plan, any number greater than that indicates some type of error or logical negative state. You can employ these exit codes to your advantage using <em>logical operators</em> to chain commands together in your jobs.</p>

      <ul>
        <li><code class="highlighter-rouge">&amp;&amp;</code> between commands means “if the first command exits 0, run the next command.</li>
        <li><code class="highlighter-rouge">||</code> between commands means “only run the next command if the first command exited &gt; 0”</li>
      </ul>

      <p>Take this statement as an example:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:info my-corp.my-env <span class="o">||</span> terminus env:create my-corp.test my-env
</code></pre>
      </div>

      <p>Because the <code class="highlighter-rouge">env:info</code> terminus command exits <code class="highlighter-rouge">1</code> if the <code class="highlighter-rouge">my-env</code> multidev doesn’t exist, the <code class="highlighter-rouge">env:create</code> command only ever runs when it needs to.</p>

      <p>Next, learn about <a href="#substitution">command substitution</a>.</p>

    </div>
  </div>
  <div id="substitution" class="col s12">
<div>

      <h3 id="command-substitution">Command Substitution</h3>

      <p>Sometimes, you want to use the output of a command as an argument to another command, or occasionally, the basis for another command entirely. Use <em>command substitution</em> to solve these needs.</p>

      <p>Here’s an example statement that uses the output of one command as an argument in another.</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:create my-corp.test <span class="sb">`</span>git rev-parse --abbrev-ref HEAD<span class="sb">`</span>
</code></pre>
      </div>

      <p>This would create a multidev environment, based on the database and files of the test environment, named after the currently active git branch in the current working directory.</p>

      <p>This example statement uses the output of one command as the basis for a different command.</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="sb">`</span>terminus connection:info my-corp.test --field<span class="o">=</span>mysql_command<span class="sb">`</span> -e <span class="s2">"TRUNCATE sessions;"</span>
</code></pre>
      </div>

      <p>This would truncate the <code class="highlighter-rouge">sessions</code> table on the test environment using the MySQL client.</p>

      <p>Next, learn about <a href="#variables">variables</a>.</p>

    </div>
  </div>
  <div id="variables" class="col s12">
<div>

      <h3 id="variables">Variables</h3>

      <p>As you build out your library of jobs, you may find that some of your operations are generic enough that they could easily be run on any number of sites. Instead of copy/pasting jobs, you can use <em>variables</em> to reduce repetition.</p>

      <p>You’ll likely want to use variables with <strong>default values</strong> as you’re starting out:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:clear-cache <span class="k">${</span><span class="nv">TSITE_ENV</span><span class="k">:-</span><span class="nv">my</span><span class="p">-corp.test</span><span class="k">}</span>
</code></pre>
      </div>

      <p>This allows you to run the job using the drush.io UI (which doesn’t provide a way to customize variables at run-time), but enables API users to provide custom values.</p>

      <p>For commands that don’t make sense without custom values, you could use <strong>simple variables</strong> like this:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:delete <span class="nv">$TSITE_ENV</span> --yes
</code></pre>
      </div>

      <p>This command would only delete a multidev environment if a value like <code class="highlighter-rouge">my-corp.my-env</code> were provided via the API.</p>

      <p>Also note that you can concatenate variables to form a single argument. For example, if you primarily work on one site, but wish to add the flexibility of swapping sites in your job, you could use this common pattern:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:delete <span class="k">${</span><span class="nv">TSITE</span><span class="k">:-</span><span class="nv">my</span><span class="p">-corp</span><span class="k">}</span>.<span class="nv">$TENV</span> --yes
</code></pre>
      </div>

      <p>Here, you could choose to only provide a <code class="highlighter-rouge">TENV</code> value in your API call, which would default to deleting the provided environment on the <code class="highlighter-rouge">my-corp</code> site. Or, you could provide both a <code class="highlighter-rouge">TENV</code> and a <code class="highlighter-rouge">TSITE</code> to delete a multidev elsewhere.</p>

      <p>Next, learn about <a href="#io-redirection">I/O redirection</a></p>

    </div>
  </div>
  <div id="io-redirection" class="col s12">
<div>

      <h3 id="io-redirection">I/O Redirection</h3>

      <p>Sometimes, you don’t want the output of a command to be displayed. In such cases, you can use <em>I/O redirection</em> to pipe command output away from standard out.</p>

      <p>A common use-case for this is running set-up commands, but returning a clean, API response:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:create <span class="k">${</span><span class="nv">TSITE</span><span class="k">}</span>.test <span class="nv">$TENV</span> --yes &gt; /dev/null <span class="o">&amp;&amp;</span> <span class="se">\</span>
  terminus env:info <span class="k">${</span><span class="nv">TSITE</span><span class="k">}</span>.<span class="nv">$TENV</span> --format<span class="o">=</span>json
</code></pre>
      </div>

      <p>This statement would create a multidev environment and, if successful, print a JSON payload to the log output containing useful information like domain or creation date.</p>

      <p>By hiding the output of the set-up commands, you can design a JSON API for yourself based on the log output of the job run.</p>

      <p>Now that you know the runtime environment and job syntax, you’re ready to build a custom ops platform on <a href="/api">the drush.io API</a>.</p>

    </div>
  </div>
</div>

        </article>
<!--    </div>
</div>-->

    </main>
    <footer class="page-footer no-margin __top grey darken-4">
          <div class="container container-large">
    <div class="row">
      <div class="col l4 s12">
        <h5 class="white-text">Links</h5>
        <ul>
          
          <li><a class="grey-text text-lighten-3" href="https://github.com/drush-io"><i class="fa fa-github"></i>&nbsp;&nbsp;drush-io</a></li>
          <li><a class="grey-text text-lighten-3" href="https://twitter.com/drush_io"><i class="fa fa-twitter"></i>&nbsp;&nbsp;@drush_io</a></li>
          
          
        </ul>
      </div>
      <div class="col l6 offset-l2 s12 right-align">
        <h5 class="white-text"><img src="/assets/img/logo-64.png" alt="drush.io" class="logo" /> drush.io</h5>
        <p class="grey-text text-lighten-4">Training guides and documentation for drush.io, the distributed runtime utility shell.
</p>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container center-align">
      © 2017 drush.io. All Rights Reserved.
    </div>
  </div>

    </footer>
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/materialize.min.js"></script>
<script type="text/javascript">
  $('.button-collapse').sideNav();
  $('nav a:not(".brand-logo"), .tabs a').addClass('waves-effect waves-light');
  $('.tabs a[href^="#"]').click(function onTabClick() {
    history.replaceState(undefined, undefined, $(this).attr('href'));
  });
  $('article .container a[href^="#"]').click(function onContentTabChange() {
    var $anchor = $(this);
    $('html, body').animate({scrollTop: 0}, 400, function onScrollComplete() {
      $('.tabs').tabs('select_tab', $anchor.attr('href').replace(/\#/, ''));
    });
  });
</script>

</body>
</html>
