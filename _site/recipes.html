<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Recipes</title>
    <meta name="description" content="Training guides and documentation for drush.io, the distributed runtime utility shell.
">
    <link type="text/css" rel="stylesheet" href="/assets/css/app.css" media="screen,projection">
    <link type="text/css" rel="stylesheet" href="/assets/css/pygments.css" media="screen,projection">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="canonical" href="http://localhost:4000/recipes">
</head>

<body>
    <header>
        <div class="navbar-fixed">
<nav class="white blue-text z-depth-0">
    <ul id="slide-out" class="side-nav">
        <li><a href="/">Home</a></li>
        
            
                <li><a href="/api">API</a></li>
            
        
            
        
            
                <li><a href="/getting-started">Getting Started</a></li>
            
        
            
        
            
                <li><a href="/jobs-and-the-runtime">Jobs & the Runtime</a></li>
            
        
            
                <li><a href="/recipes">Recipes</a></li>
            
        
            
                <li><a href="/the-basics">The Basics</a></li>
            
        
    </ul>
    <div class="container container-large">
    <a class="brand-logo" href="/"><span class="grey-text text-darken-4"><img src="/assets/img/logo-64.png" alt="drush.io" class="logo" /> drush.io</span></a>
    <ul class="right hide-on-med-and-down">
        
        
            
        
            
        
            
                <li><a href="/the-basics" class="grey-text text-darken-4">The Basics</a></li>
            
        
            
                <li><a href="/getting-started" class="grey-text text-darken-4">Getting Started</a></li>
            
        
            
                <li><a href="/recipes" class="grey-text text-darken-4">Recipes</a></li>
            
        
            
                <li><a href="/jobs-and-the-runtime" class="grey-text text-darken-4">Jobs & the Runtime</a></li>
            
        
            
                <li><a href="/api" class="grey-text text-darken-4">API</a></li>
            
        
    </ul>
    <a href="#" data-activates="slide-out" class="button-collapse right grey-text text-darken-4"><i class="material-icons">keyboard_arrow_down</i></a>
    </div>
</nav>
</div>

    </header>
    <main>
        <div class="grey lighten-2">
    <div class="row no-margin">
        <div class="col s12">
            <h2 class="center-align">Recipes</h2>
            <div class="divider"></div>
        </div>
    </div>
</div>
<!--<div class="container">
    <div class="section">-->
        <article class="row no-margin grey-text text-darken-2 post-content">
            <div class="col s12 no-padding">
  <ul class="tabs tabs-fixed-width">
    <li class="tab col s3"><a href="#intro"><i class="material-icons">open_in_browser</i> Intro</a></li>
    <li class="tab col s3"><a href="#common-job-templates"><i class="material-icons">content_paste</i> Common Job Templates</a></li>
    <li class="tab col s3"><a href="#custom-code"><i class="material-icons">code</i> Custom/Complex Code</a></li>
    <li class="tab col s3"><a href="#chatops"><i class="material-icons">chat</i> ChatOps</a></li>
  </ul>
</div>
<div class="container">
  <div id="intro" class="col s12">
<div>

      <h3 id="introduction">Introduction</h3>

      <p>The drush.io runtime enables you to encapsulate jobs that are highly specific to your needs and the ways your team works.</p>

      <p>Many workflows you may wish to implement are common among Pantheon users or can be accomplished using common strategies. Use these recipes to help you get up to speed more quickly.</p>

      <ul>
        <li><a href="#common-job-templates">Common job templates</a></li>
        <li><a href="#custom-code">Running custom code in the runtime</a></li>
        <li><a href="#chatops">Get started with ChatOps</a></li>
      </ul>

    </div>
  </div>
  <div id="common-job-templates" class="col s12">
<div>

      <h3 id="common-job-templates">Common Job Templates</h3>

      <p>Below are a few common jobs you may wish to tailor to your needs or use as inspiration.</p>

      <h4 id="deploy-to-dev-through-live"><strong>Deploy to dev through live</strong></h4>
      <p>One common scenario is pulling the latest master branch from a remote git repository (like GitHub, GitLab, BitBucket, etc), pushing to Pantheon, then pushing through test and live. Use a job like this to make this process as simple and repeatable as possible.</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="c"># Clone from a non-Pantheon git remote to the cwd</span>
git clone --quiet git@github.com:YOUR-ORG/YOUR-SITE .

<span class="c"># Push this code to your dev env.</span>
git remote add pantheon ssh://codeserver.dev.UUID@codeserver.dev.UUID.drush.in:2222/~/repository.git
git push pantheon master

<span class="c"># Deploy to test env</span>
terminus env:deploy YOUR-SITE.test -y --note<span class="o">=</span><span class="s2">"Deployed via drush.io"</span>

<span class="c"># Deploy to live env</span>
terminus env:deploy YOUR-SITE.live -y --note<span class="o">=</span><span class="s2">"Deployed via drush.io"</span>
</code></pre>
      </div>

      <h4 id="refresh-test-environment"><strong>Refresh test environment</strong></h4>
      <p>Keeping pre-production environments in a state closely matching production can be a chore. Use a job like this to help automate the process.</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="c"># Clone from live to test</span>
terminus env:clone-content YOUR-SITE.live <span class="nb">test</span> -y

<span class="c"># Clean out unneeded data on the test site</span>
<span class="sb">`</span>terminus connection:info YOUR-SITE.test --field<span class="o">=</span>mysql_command<span class="sb">`</span> <span class="se">\</span>
  -e <span class="s2">"TRUNCATE watchdog;"</span>

<span class="c"># Set up test user accounts if necessary</span>
terminus remote:drush YOUR-SITE.test -- <span class="se">\</span>
  user-add-role <span class="s2">"administrator"</span> --mail<span class="o">=</span><span class="s2">"user@example.com"</span>
</code></pre>
      </div>

      <p>You may even wish to go a step further and run this job on a nightly basis using a cron service so that your test environment automatically reflects production each morning.</p>

    </div>
  </div>
  <div id="custom-code" class="col s12">
<div>

      <h3 id="custom-and-complex-code">Custom and Complex Code</h3>

      <p>For jobs that require advanced conditional logic, parsing of API responses, or other complex customizations, we recommend <a href="https://pantheon.io/docs/terminus/plugins/create/">writing a Terminus plugin</a> or using <a href="https://pantheon.io/docs/terminus/plugins/directory/">an existing plugin</a>.</p>

      <p>Use this command set to install Terminus plugins in your job at runtime using something like the following:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/terminus-plugin-project/terminus-site-status-plugin.git <span class="se">\</span>
  --quiet --branch 1.1.4 --depth 1 <span class="se">\</span>
  <span class="nv">$TERMINUS_PLUGINS_DIR</span>/site-status
</code></pre>
      </div>

      <p>Where the <code class="highlighter-rouge">--quiet</code> flag is used to suppress output, the <code class="highlighter-rouge">--branch</code> flag specifies a specific release tag (<code class="highlighter-rouge">1.1.4</code>), and <code class="highlighter-rouge">--depth</code> specifies a shallow clone (of just a single commit) to optimize clone performance.</p>

      <p>Once installed, you can use the Terminus plugin as intended:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus site:status
</code></pre>
      </div>

      <p>For additional resources, check…</p>
      <ul>
        <li>The <a href="https://pantheon.io/docs/terminus/plugins/create/">Pantheon docs on writing Terminus plugins</a></li>
        <li>A short list of <a href="https://pantheon.io/docs/terminus/plugins/directory/">existing Terminus plugins</a></li>
        <li>A <a href="https://github.com/terminus-plugin-project">community repository of Terminus plugins</a></li>
      </ul>

    </div>
  </div>
  <div id="chatops" class="col s12">
<div>

      <h3 id="chatops">ChatOps</h3>

      <p>ChatOps is <a href="https://www.atlassian.com/blog/software-teams/what-is-chatops-adoption-guide">a collaboration model</a> that puts people, process, tools, and automation into one place. Implemented well, it allows dev teams to work, collaborate, and learn together in an efficient, transparent way.</p>

      <p>One common tool used to implement ChatOps at organizations is <a href="https://hubot.github.com/">Hubot</a>, an open source chat bot platform. Use <a href="https://hubot.github.com/docs/adapters/">adapters</a> to integrate Hubot with your chat service (Slack, HipChat, etc). Install or write <a href="https://hubot.github.com/docs/scripting/">scripts</a> to add custom functionality to your chatbot.</p>

      <p>If you don’t use Hubot already, check out these guides on getting started with your first chat bot:</p>

      <ul>
        <li><a href="https://hubot.github.com/docs/">Official Hubot documentation</a></li>
        <li><a href="https://lornajane.net/posts/2015/set-up-your-first-hubot">Set up your first Hubot</a> by LornaJane</li>
      </ul>

      <h4 id="drushio-hubot-script"><strong>drush.io hubot script</strong></h4>
      <p>You can install the <a href="https://www.npmjs.com/package/@drush-io/hubot-drush-io">official drush.io hubot script</a> to quickly integrate drush.io with your chat bot. Once installed, you can run commands like</p>

      <ul>
        <li><code class="highlighter-rouge">hubot drush.io token set [API TOKEN]</code> in private chat with your bot to authenticate with drush.io</li>
        <li><code class="highlighter-rouge">hubot drush.io run [PROJECT] job [JOB]</code> to trigger a specific job on drush.io</li>
      </ul>

      <h4 id="custom-drushio-hubot-integration"><strong>Custom drush.io hubot integration</strong></h4>
      <p>To get the most out of drush.io/hubot integration, you may wish to write your own library of hubot commands, built on top of the hubot drush.io script.</p>

      <p>Here’s an example custom hubot script that adds a “delete multidev” command that triggers a job called <code class="highlighter-rouge">delete-multidev</code> on the <code class="highlighter-rouge">MY-CORP</code> project, passing two custom variables (Pantheon site and Pantheon environment name) parsed from the command.</p>

      <div class="language-coffeescript highlighter-rouge"><pre class="highlight"><code><span class="c1"># Description:</span>
<span class="c1">#   MY CORP's custom drush.io hubot integration</span>
<span class="c1">#</span>
<span class="c1"># Dependencies:</span>
<span class="c1">#   "@drush-io/hubot-drush-io": "~1.0.0"</span>
<span class="c1">#</span>
<span class="c1"># Commands:</span>
<span class="c1">#   hubot delete &lt;site&gt; multidev &lt;multidev&gt;</span>

<span class="nx">module</span><span class="p">.</span><span class="na">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">robot</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">drushIoProject</span> <span class="o">=</span> <span class="s">'MY-CORP'</span>

  <span class="c1"># Hubot, delete (site) multidev (env)</span>
  <span class="nx">robot</span><span class="p">.</span><span class="na">hear</span> <span class="sr">/delete [a-z0-9\-]{2,48} multidev ([a-z0-9\-]{2,12})/i</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">jobPayload</span> <span class="o">=</span>
      <span class="na">TSITE</span><span class="o">:</span> <span class="nx">msg</span><span class="p">.</span><span class="na">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="na">TENV</span><span class="o">:</span> <span class="nx">msg</span><span class="p">.</span><span class="na">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nx">msg</span><span class="p">.</span><span class="na">send</span> <span class="s">"Beginning multidev delete."</span>
    <span class="nx">robot</span><span class="p">.</span><span class="na">drush</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">drushIoProject</span><span class="p">,</span> <span class="s">'delete-multidev'</span><span class="p">,</span> <span class="nx">jobPayload</span><span class="p">).</span><span class="na">then</span> <span class="p">(</span><span class="nx">run</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">status</span> <span class="o">==</span> <span class="s">'complete'</span><span class="p">)</span>
        <span class="nx">msg</span><span class="p">.</span><span class="na">send</span> <span class="s">"Multidev successfully deleted."</span>
        <span class="nx">msg</span><span class="p">.</span><span class="na">send</span> <span class="nx">run</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">log</span>
      <span class="k">else</span>
        <span class="nx">msg</span><span class="p">.</span><span class="na">send</span> <span class="s">"There may have been a problem..."</span>
        <span class="nx">msg</span><span class="p">.</span><span class="na">send</span> <span class="nx">run</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">log</span>
</code></pre>
      </div>

      <p>On drush.io, the corresponding <code class="highlighter-rouge">delete-multidev</code> job might look something like this:</p>

      <div class="language-sh highlighter-rouge"><pre class="highlight"><code>terminus env:delete <span class="k">${</span><span class="nv">TSITE</span><span class="k">}</span>.<span class="k">${</span><span class="nv">TENV</span><span class="k">}</span> --delete-branch --yes
</code></pre>
      </div>

    </div>
  </div>
</div>

        </article>
<!--    </div>
</div>-->

    </main>
    <footer class="page-footer no-margin __top grey darken-4">
          <div class="container container-large">
    <div class="row">
      <div class="col l4 s12">
        <h5 class="white-text">Links</h5>
        <ul>
          
          <li><a class="grey-text text-lighten-3" href="https://github.com/drush-io"><i class="fa fa-github"></i>&nbsp;&nbsp;drush-io</a></li>
          <li><a class="grey-text text-lighten-3" href="https://twitter.com/drush_io"><i class="fa fa-twitter"></i>&nbsp;&nbsp;@drush_io</a></li>
          
          
        </ul>
      </div>
      <div class="col l6 offset-l2 s12 right-align">
        <h5 class="white-text"><img src="/assets/img/logo-64.png" alt="drush.io" class="logo" /> drush.io</h5>
        <p class="grey-text text-lighten-4">Training guides and documentation for drush.io, the distributed runtime utility shell.
</p>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container center-align">
      © 2017 drush.io. All Rights Reserved.
    </div>
  </div>

    </footer>
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/materialize.min.js"></script>
<script type="text/javascript">
  $('.button-collapse').sideNav();
  $('nav a:not(".brand-logo"), .tabs a').addClass('waves-effect waves-light');
  $('.tabs a[href^="#"]').click(function onTabClick() {
    history.replaceState(undefined, undefined, $(this).attr('href'));
  });
  $('article .container a[href^="#"]').click(function onContentTabChange() {
    var $anchor = $(this);
    $('html, body').animate({scrollTop: 0}, 400, function onScrollComplete() {
      $('.tabs').tabs('select_tab', $anchor.attr('href').replace(/\#/, ''));
    });
  });
</script>

</body>
</html>
